---
description: 
globs: 
alwaysApply: true
---
---
description: ã—ã‚ƒã¹ã‚‹ãƒãƒ¼ãƒˆ â€“ è©³ç´°ãƒ»æ®µéšçš„å®Ÿè£…è¨ˆç”»
---

ã¾ãšã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ãŸã‚‰ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç™ºè¨€ã™ã‚‹ã“ã¨

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã—ã‚ƒã¹ã‚‹ãƒãƒ¼ãƒˆã®å®Ÿè£…è¨ˆç”»æ›¸ã§ã™ã€‚
ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨ˆç”»ã«å¾“ã£ã¦ã€å®Ÿè£…ã‚’å®Ÿè¡Œã—ã¦ã„ã£ã¦ãã ã•ã„ã€‚

## 0. å‰æ
* ãƒªãƒã‚¸ãƒˆãƒª: GitHub (main / develop / feature-*)
* å·¥ç¨‹ç²’åº¦: 2 é€±é–“ã‚¹ãƒ—ãƒªãƒ³ãƒˆ  
* ãƒ•ã‚§ãƒ¼ã‚º: Î±(Core) â†’ Î²(Cloud) â†’ GA(Production)  
* æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯: React Native Expo + FastAPI (Cloud Run) + Cloud SQL/PostgreSQL + Google Cloud Storage + Pub/Sub + Terraform + GitHub Actions
---

## 1. å…¨ä½“ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå›³å¼ï¼‰
| æœˆ | 1w | 2w | 3w | 4w |
|----|----|----|----|----|
| 2025-05 | ğŸ“¦Repo/CI | ğŸ¨FE scaffold | ğŸ—„ï¸BE scaffold | ğŸ”Auth |
| 2025-06 | ğŸ™ï¸Recorder | ğŸš€Media API | ğŸ“Local Note | ğŸ”„Î±çµåˆ |
| 2025-07 | ğŸ§ªÎ±QA | âœ…Î±Release (07-31) |   |   |
| 2025-08 | â˜ï¸Sync | ğŸ–¼ï¸OCR | ğŸ¤–AI Chat | ğŸ”„Î²çµåˆ |
| 2025-09 | ğŸ§ªÎ²QA | âœ…Î²Release (09-15) |   |   |
| 2025-10 | ğŸ’°Billing | ğŸ”ŠTTS polish | ğŸ›¡ï¸Hardening | ğŸGA QA |
| 2025-11 | ğŸ“±Store submit | âœ…GA (11-01) |   |   |

---

## 2. ãƒ•ã‚§ãƒ¼ã‚ºã‚´ãƒ¼ãƒ« & Done å®šç¾©
| Phase | ã‚´ãƒ¼ãƒ« | å®Œäº†åŸºæº– (Must) |
|-------|--------|----------------|
| Î±(Core) | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³éŒ²éŸ³â†’æ–‡å­—èµ·ã“ã—â†’ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ | âš™ï¸éŒ²éŸ³90m/STTéåŒæœŸ, ğŸ–‹ï¸Canvas basic, SQLiteã‚­ãƒ£ãƒƒã‚·ãƒ¥, Jest>80% |
| Î²(Cloud) | ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ+OCR+AIãƒãƒ£ãƒƒãƒˆ | ğŸŒREST/WS å…¨API, Cloud SQL, OCR/PDF Import, GPTæ ¡æ­£è¦ç´„, Detox E2E |
| GA | ã‚¹ãƒˆã‚¢å…¬é–‹ & åŸºæœ¬èª²é‡‘ | ğŸªApp Store/Play é…ä¿¡, In-App Purchase Stub, p95<400 ms, Crash<1% |

---

## 3. ã‚¹ãƒ—ãƒªãƒ³ãƒˆè¨ˆç”»ï¼ˆ2 é€±é–“ï¼‰
| Sprint | æœŸé–“ | ä¸»ãƒ†ãƒ¼ãƒ | ä¸»è¦ã‚¿ã‚¹ã‚¯ | å—å…¥ | Owner |
|--------|------|----------|-----------|------|-------|
| 0 | 05/05-05/18 | Repo & CI åŸºç›¤ | monorepo, ESLint/Black, GitHub Actions, Terraform skeleton | CI green | DevOps |
| 1 | 05/19-06/01 | Backend/Frontend Scaffold | FastAPI project, Expo init, Tailwind, Firebase SDK, lint/test boilerplate | `/healthz` pass | BE/FE |
| 2 | 06/02-06/15 | èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ | Firebase Auth verify, Users table, Secure route guard, Login UI | Sign-In flow | BE/FE |
| 3 | 06/16-06/29 | éŒ²éŸ³ & Media Upload | expo-av helper, SignedURL API, Resumable PUT, Progress UI | 90 m file upload | FE |
| 4 | 06/30-07/13 | STT Worker & Transcript | Pub/Sub trigger, STT async, Transcript DB, Webhook, Viewer UI | WERâ‰¤12% sample | BE |
| 5 | 07/14-07/27 | Canvas & Local Note CRUD | react-native-skia drawing, Undo/Redo, SQLite persistence, Dashboard list, **CanvasEditor Î²ç‰ˆ** | Note save/reopen | FE |
| 6 | 07/28-07/31 | Î± çµåˆ & QA | Integration tests, Crashlytics, TestFlight build | Î±ãƒªãƒªãƒ¼ã‚¹ | All |
| 7 | 08/01-08/14 | Cloud Sync v1 | REST notebooks/pages, delta sync queue, conflict merge | Online-offline roundtrip | BE/FE |
| 8 | 08/15-08/28 | OCR & Import | Vision API OCR, PDF/URL worker, Import UI flow | OCR â‰¥95% | BE/FE |
| 9 | 08/29-09/11 | AI Chat Widget | GPT-4o proxy, Proofread/Summary prompts, UI overlay, **CanvasEditorã«AIã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆçµ±åˆ** | Chat returns diff | BE/FE |
| 10 | 09/12-09/15 | Î² çµåˆ & QA | Detox E2E, Load test 200 rps, Bugfix | Î²ãƒªãƒªãƒ¼ã‚¹ | QA |
| 11 | 09/16-09/29 | Billing & Settings | Stripe/StoreKit stub, Plan switch, Settings screens | Purchase mock ok | BE/FE |
| 12 | 09/30-10/13 | TTS & A11y Polish | Cloud TTS voices, Reading ruler, Color scheme | A11y audits pass | FE |
| 13 | 10/14-10/27 | Hardening & Observability | SLO alerting, Profiler, Pen-lag optimize | p95<400 ms | DevOps |
| 14 | 10/28-11/01 | GA QA & Store Submit | Localization, Store assets, Policy checks | Store accepted | QA/PM |

---

## 4. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯è©³ç´°
### 4.1 API å®Ÿè£…é †
1. `/healthz`, `/version`
2. Auth middleware (`firebase-admin`)
3. Notebooks CRUD
4. Pages CRUD + canvas JSON
5. SignedURL (`/media/upload-url`)
6. Media status & webhook
7. STT WebSocket proxy
8. AI Chat proxy (`/ai/chat`)
9. Tag Recommend batch
10. Admin & metrics endpoints

### 4.2 Worker / Job
| Name | å½¹å‰² | Trigger |
|------|------|---------|
| media-worker | STT/OCR å®Ÿè¡Œãƒ»ä¿å­˜ | Pub/Sub `media.new` |
| tagger | GPT ãƒãƒ¼ãƒˆåˆ†é¡ | Cloud Scheduler daily |
| cleanup | GCS TTL delete | Cloud Scheduler weekly |

### 4.3 STT/TTS Provider æŠ½è±¡åŒ–
| Provider | ç”¨é€” | å®Ÿè£…å„ªå…ˆåº¦ |
|---------|------|----------|
| GoogleSTTProvider | æ¨™æº– STT (70+ è¨€èª) | Sprint 4 (é«˜) |
| MiniMaxTTSProvider | é«˜å“è³ªéŸ³å£°åˆæˆ | Sprint 12 (é«˜) |
| ParakeetProvider | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è‹±èª STT | Sprint 8 (ä¸­) |
| LocalProvider | å°†æ¥æ‹¡å¼µç”¨ | æœªå®š (ä½) |

**MiniMax Audio TTS æ¤œè¨¼é …ç›® (Sprint 10 Spike)**
* Starterãƒ—ãƒ©ãƒ³(æœˆé¡$5)ã®å®Ÿç”¨æ€§ç¢ºèªï¼ˆç´„ 4.5 æ™‚é–“/æœˆã®ç”Ÿæˆé‡ï¼‰
* APIãƒ©ãƒƒãƒ‘ãƒ¼å®Ÿè£…ï¼ˆã‚­ãƒ¼ã¯SecretManagerç®¡ç†ï¼‰
* æ—¥æœ¬èªéŸ³å£°å“è³ªè©•ä¾¡ï¼ˆè‡ªç„¶ã•ã€ã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ï¼‰
* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å†ç”Ÿç”¨ã«ç”ŸæˆéŸ³å£°ã®SQLiteã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…

**Parakeet-TDT æ¤œè¨¼é …ç›® (Sprint 2 Spike)**
* GKE/L4 GPU ãƒãƒ¼ãƒ‰ã§ã®æ¨è«–ã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰
* åŒä¸€éŸ³æºã§ã® Google STT ã¨ã® WER / å‡¦ç†æ™‚é–“ / ã‚³ã‚¹ãƒˆæ¯”è¼ƒ
* ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º (~2 GB) é…å¸ƒæ–¹å¼ã¨ CC-BY è¡¨è¨˜ãƒ•ãƒ­ãƒ¼ç¢ºèª

### 4.4 AI Search Provider
| Provider | ç”¨é€” | å®Ÿè£…å„ªå…ˆåº¦ |
|---------|------|----------|
| AnthropicProvider | ãƒªã‚µãƒ¼ãƒæ©Ÿèƒ½ãƒ¡ã‚¤ãƒ³ | Sprint 9 (é«˜) |
| GoogleProvider | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | Sprint 9 (ä¸­) |

**Anthropic Search API æ¤œè¨¼é …ç›® (Sprint 3 Spike)**
* 30 req ã§ã® Recall/Latency/Cost æ¯”è¼ƒï¼ˆJP/EN å„ 15 ã‚¯ã‚¨ãƒªï¼‰
* BE: `anthropic.py` ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…ï¼ˆAPI ã‚­ãƒ¼ SecretManager ç®¡ç†ï¼‰
* FE: å¼•ç”¨ãƒªãƒ³ã‚¯ UI èª¿æ•´ï¼ˆfavicon, ãƒ‰ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºï¼‰

### 4.5 Tech Debt Gate
* 90% type-hint coverage
* OpenAPI 3.1 â†’ Redoc autoserve
* 100 rps load â‡’ <200 ms

---

## 5. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯è©³ç´°
### 5.1 ç”»é¢å„ªå…ˆåº¦ (MVP)
1. WelcomeLogin / Onboarding
2. Dashboard (list/search)
3. VoiceOverlay
4. CanvasEditor (+AI Widget)
5. PhotoScan / ImportData
6. Settings stack

### 5.2 ã‚³ã‚¢æ©Ÿèƒ½
* Recorder â€“ expo-av, wav encoder (16 kHz)
* WebSocket STT â€“ PCM 250 ms
* Canvas â€“ skia, 100 undo
* OfflineQueue â€“ zustand persister
* Accessibility â€“ UD fonts, high-contrast

### 5.3 ãƒ†ã‚¹ãƒˆ
* Unit (Jest) â‰¥80% lines
* Detox: recordâ†’stopâ†’transcript
* OTA channel: staging / production

---

## 6. ã‚¤ãƒ³ãƒ•ãƒ© & DevOps
| é …ç›® | ãƒ„ãƒ¼ãƒ« | Done æ¡ä»¶ |
|------|-------|-----------|
| IaC | Terraform | `terraform plan` clean |
| CI | GitHub Actions | Lint, Test, Build OK |
| CD | Cloud Buildpacks | Auto-deploy develop->dev |
| Observability | Cloud Trace/Profiler | Dashboards live |
| Secrets | Secret Manager | No plain creds in Git |

---

## 7. QA / ãƒ†ã‚¹ãƒˆè¨ˆç”»
| ãƒ¬ã‚¤ãƒ¤ | æ‰‹æ³• | å·¥å…· |
|--------|------|------|
| Unit | Jest / Pytest | coverage gate |
| API | Postman/newman | contract tests |
| Perf | k6 | 200 rps, 5 min |
| E2E | Detox, Playwright | critical path |
| Accessibility | react-native-a11y, Lighthouse | score â‰¥90 |

---

## 8. ãƒªã‚¹ã‚¯ & ãƒ–ãƒ­ãƒƒã‚«ãƒ¼
| ãƒªã‚¹ã‚¯ | å¯¾ç­– |
|--------|------|
| STT ç²¾åº¦ä½ä¸‹ | ç·¨é›† UI + GPT è£œæ­£ |
| å¤§å®¹é‡éŒ²éŸ³ã‚¢ãƒƒãƒ—å¤±æ•— | Resumable + Retry queue |
| ãƒ¢ãƒã‚¤ãƒ«æç”»é…å»¶ | Skia GPU tuning |
| GPT API ã‚³ã‚¹ãƒˆ | Token monitoring & cache |
| å¯©æŸ»ãƒªã‚¸ã‚§ã‚¯ãƒˆ | ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³äº‹å‰ãƒã‚§ãƒƒã‚¯ |

---

## 9. ä»˜éŒ²
### 9.1 Definition of Done
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ 2 äººé€šé
- Unit test pass & coverage gate
- Lint/format pass
- CI green, image scan pass
- PR lab