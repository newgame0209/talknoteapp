# 📄 インポート機能実装計画書

> **プロジェクト**: しゃべるノート - インポート機能フル実装  
> **開始日**: 2025-01-05  
> **想定期間**: 2-3週間  
> **担当**: 開発チーム  

---

## 📊 プロジェクト概要

### 🎯 目標
- URLからのWebページ・YouTubeインポート機能の完全実装
- ファイル（PDF・txt）インポート機能の完全実装
- 複数ページ自動分割機能の統合
- AIタイトル自動生成機能の統合
- 既存自動保存システムへの完全統合

### 📈 成功定義
- [ ] ユーザーがWebページURLを入力してノート作成可能
- [ ] PDF・txtファイルのアップロード・テキスト抽出・ノート作成が完全動作
- [ ] 2000文字を超えるコンテンツの自動ページ分割機能
- [ ] AI生成タイトルの自動設定
- [ ] import型ノートの自動保存・復帰機能

---

## 🔍 現状分析

### ✅ 実装済み機能
| 機能 | 実装状況 | 詳細 |
|------|-----------|------|
| **UI/UX** | 🟢 完了 | インポートモーダル、ファイル選択、進捗画面 |
| **ファイルアップロード** | 🟢 完了 | チャンク分割、mediaApi、ストレージプロバイダー |
| **データモデル** | 🟢 完了 | UniversalNote、import型、複数ページ対応 |
| **自動保存基盤** | 🟢 完了 | useAutoSave Hook、UniversalNoteService |
| **バックエンド基盤** | 🟢 完了 | FastAPI、認証、ストレージ、データベース |

### ❌ 未実装機能
| 機能 | 状況 | 優先度 |
|------|------|--------|
| **URLインポートAPI** | 🔴 未実装 | 高 |
| **ファイル処理API** | 🔴 未実装 | 高 |
| **実際のノート作成フロー** | 🔴 不完全 | 高 |
| **AIタイトル生成統合** | 🔴 未実装 | 中 |
| **複数ページ分割統合** | 🔴 部分実装 | 中 |

---

## 🚀 実装計画

### Phase 1: バックエンド基盤構築 (3-4日)

#### 📦 Step 1.1: 依存関係追加 (30分)
**成果物**: 更新されたrequirements.txt
```bash
# backend/requirements.txtに追加
pypdf==3.0.1
chardet==5.2.0
```

#### 🔧 Step 1.2: ファイル処理サービス実装 (4-6時間)
**成果物**: `app/services/file_processor.py`
- PDFテキスト抽出（pypdf使用）
- txtファイル読み込み（chardet使用）
- エンコーディング自動検出
- エラーハンドリング

#### 🌐 Step 1.3: URLインポートサービス実装 (6-8時間)
**成果物**: `app/services/url_importer.py`
- HTTPリクエスト・HTML解析
- YouTubeメタデータ・字幕取得
- テキスト清書・構造化
- URLバリデーション

#### 🚀 Step 1.4: インポートAPI実装 (3-4時間)
**成果物**: `app/api/api_v1/endpoints/import.py`
- `POST /api/v1/import/url` - URLインポートエンドポイント
- `POST /api/v1/import/file` - ファイルインポートエンドポイント
- レスポンススキーマ定義

### Phase 2: フロントエンド統合 (3-4日)

#### 📱 Step 2.1: URLインポート処理完成 (2-3時間)
**成果物**: 更新されたDashboardScreen.tsx
- `executeImport`関数のURL処理部分完成
- API呼び出し・エラーハンドリング

#### 📄 Step 2.2: ファイルインポート処理完成 (4-5時間)
**成果物**: 更新されたImportProgressScreen.tsx、新規ImportService.ts
- 実際のファイルアップロード・処理API呼び出し
- ノート作成完了後のCanvasEditor遷移

#### 🤖 Step 2.3: AIタイトル生成統合 (2-3時間)
**成果物**: 更新されたImportService.ts
- 既存AI API活用
- フォールバック処理（生成失敗時）

### Phase 3: 複数ページ統合 (2-3日)

#### 📚 Step 3.1: 複数ページ分割ロジック統合 (4-5時間)
**成果物**: 更新されたUniversalNoteService.ts
- 2000文字制限での自動分割
- import型専用分割ロジック

#### 🎨 Step 3.2: CanvasEditor複数ページ表示 (3-4時間)
**成果物**: 更新されたCanvasEditor.tsx
- import型ノート判定・特別処理
- ページナビゲーションバー表示

### Phase 4: 自動保存システム統合 (1-2日)

#### 💾 Step 4.1: useAutoSave統合 (2-3時間)
**成果物**: 更新されたuseAutoSave.ts
- import型ノート判定処理
- 複数ページ保存対応

#### 🔄 Step 4.2: UniversalNoteService完成 (2-3時間)
**成果物**: 更新されたUniversalNoteService.ts
- import型ノートのCRUD操作完成

### Phase 5: 統合テスト・改善 (2-3日)

#### 🧪 Step 5.1: 機能テスト (1日)
**テストケース**:
- [ ] WebページURL → ノート作成 → 複数ページ分割
- [ ] YouTubeURL → ノート作成 → AIタイトル生成
- [ ] PDFファイル → アップロード → テキスト抽出 → ノート作成
- [ ] txtファイル → 日本語エンコーディング → ノート作成
- [ ] import型ノート → 自動保存 → 復帰

#### 🛠️ Step 5.2: バグ修正・UX改善 (1-2日)

---

## 🎯 マイルストーン

### Week 1 (Phase 1-2)
- [ ] バックエンドAPI完成
- [ ] フロントエンド基本機能完成
- [ ] 単一ページインポート動作確認

### Week 2 (Phase 3-4)
- [ ] 複数ページ分割機能完成
- [ ] 自動保存システム統合完成

### Week 3 (Phase 5)
- [ ] 統合テスト完了
- [ ] リリース準備完了

---

## ⚠️ リスク・対策

### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| PDF解析精度問題 | 中 | pdfplumberへの切り替え検討 |
| WebスクレイピングAPIブロック | 中 | User-Agent・リクエスト間隔調整 |
| 大容量ファイル処理性能 | 中 | チャンク分割サイズ最適化 |

---

## 📞 次のアクション

1. **✅ この計画書の確認・承認**
2. **🚀 Phase 1.1開始**: requirements.txt更新
3. **📅 進捗確認**: 各Phase完了時

---

> **更新履歴**  
> - 2025-01-05: 初版作成